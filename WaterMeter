#include <wiringPi.h> //библиотека для работы с GPIO. распиновка на 26: https://klenzel.de/wp-content/uploads/2014/09/wiringpi.jpg
#include <stdio.h> // библиотека для вывода на экран

#define ButtonPin 0 // это пин № 

int main(void) //начало программы, зачем void - не знаю
{
	if(wiringPiSetup() == -1)		// инициализация wiringPi
        	{                               //when initialize wiring failed,print messageto screen
        	printf("setup wiringPi failed !");
        	return 1;
        	}
		
        pinMode(ButtonPin, INPUT);              //ставим пин на ввод (будет получать землю, т.е., будет выдавать 0)
        pullUpDnControl(ButtonPin, PUD_UP);     //подтяжка пина
        int b=1;                                // задаем переменную b, которая будет фиксировать текущее значение пина (1 или 0), надо будет его фиксировать в файле на случай потери электроэнергии, чтобы при следующем включении не прибавлялись лишние цифры)
        float f;				// задаем переменную f для учета показаний счетчика
	FILE *k = fopen("/home/pi/c/file1.txt", "r"); // файл из которого читаем исходное значение счетчика
        fscanf(k,"%f",&f);			// читаем значение и записываем его в переменную
        fclose(k);				// закрываем файл
        
	//printf("значение %f\n", f);		// для отладки - проверка того, что значение присвоено
        
	
        while(1)                                //начало цикла считывания
        {
                if(digitalRead(ButtonPin) != b) //Если состояние пина не равно переменной b, то выполняем условие
                        {                               //начало условия
                        b=digitalRead(ButtonPin);       // меняем значение переменной b на текущее состояние пина (0 или 1) - было 0, стало 1 и наоборот
                        f+=0.005;                               //прибавляем к переменной f 5 литров (0,005 м3)
			//printf("прибавили 5 %.3f\n", f);                //выводим значение переменной f $ для отладки - проверка прибавки 0,005
                        
                        FILE *data = fopen("/home/pi/c/file1.txt", "w"); //открываем файл со значением счетчика для записи)
                        fprintf(data,"%.3f\n", f);  // записываем значение переменной f в файл (файл содержит только значение переменной
                        fclose(data); // закрываем файл

                        FILE *w = fopen("/var/www/html/1.html", "w"); // открываем файл для показа на веб-странице для записи в него значения счетчика
                        fprintf(w,"%.3f\n", f); // записываем значение
                        fclose(w); //закрываем файл
			}                               //конец условия
        	delay(1000);                            //задержка в 1 секунду. Говорят, что за секунду 5 литров не выльется

        }                                               //конец цикла

        return 0;                                       //конец программы (типа того)
}                                                       //конец main
